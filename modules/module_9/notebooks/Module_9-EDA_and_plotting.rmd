---
title: "Module 9 -- Exploratory Data Analysis & plotting"
author: "Loyal Goff"
date: '2022-10-25'
output: 
  html_document:
    toc: true
    toc_level: 3
    toc_float: true
    theme: yeti
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Data Import

```{r}
setwd("modules/module_9/notebooks")
library(SummarizedExperiment)
library(tidyverse)
GEO <- "GSE63482"

# Read in the data
data <- read.csv("https://github.com/gofflab/Quant_mol_neuro_2022/raw/main/modules/module_9/notebooks/GSE63482_Expression_matrix.txt", sep = " ", header=T,row.names=1)


```



```{r}
# Parse header into parameters
sample_metadata <- as.data.frame(stringr::str_split_fixed(colnames(data), "_", 2))
colnames(sample_metadata) <- c("Age", "CellType")
sample_metadata$SampleID <- colnames(data)
colData <- DataFrame(sample_metadata)

# Create Gene metadata
gene_metadata <- data.frame(geneName = rownames(data))
rownames(gene_metadata) <- rownames(data)
gene_metadata <- DataFrame(gene_metadata)

# Create a Summarized Experiment object

# se <- SummarizedExperiment(
#     assays = list(fpkm = data),
#     rowData = gene_metadata,
#     colData = sample_metadata
# )

se <- SummarizedExperiment(
  assays=SimpleList(fpkm=as.matrix(data)),
  rowData=gene_metadata,
  colData=colData
)

```
# Indexing and manipulating data.frame objects

## Retrieving parts of a SummarizedExperiment

Retrieve expression matrix
```{r}
head(assay(se))
```

Retrieve gene metadata
This data frame has only one column in there.
```{r}
head(rowData(se))  # Dataframe with gene metadata

# Vector of gene Names
rowData(se)$geneName
```


Retrieve sample metadata
Two columns - age and cell type.
```{r}
head(colData(se))

# Retrieve the 'age' column
colData(se)$Age

colData(se)$CellType
```

```{r}
# Given a sample and a gene, retrieve the expression value
gene <- "Sox2"
sample <- "E15_cpn"
assay(se)[gene, sample]
```

# PCA
```{r}

se.pca <- prcomp(assay(se, "fpkm"), scale = TRUE, center = TRUE)

summary(se.pca)

screeplot(se.pca)

str(se.pca)

head(se.pca$x)


se.pca$x %>% 
  as.data.frame %>%
  ggplot(aes(x=PC1,y=PC2)) + geom_point(size=4) +
  theme_bw(base_size=32) + 
  theme(legend.position="top")

```





```{r}
library(ggplot2)
library(ggbio)
ggplot(se,aes(x=Age,y=Sox2),assay.id='fpkm') + geom_bar()
```

```{r}
```
```{r}
genes <- "Sox2"




---

# Exploratory Data Analysis

## Plot the distribution of gene expression values
```{r}

```

```{r}

```
# Grammar of Graphics (ggplot2)

## Plotting with ggplot2


# Session Information

```{r session}
sessionInfo()
```



```{r}
library(SummarizedExperiment)
nrows <- 200; ncols <- 6
counts <- matrix(runif(nrows * ncols, 1, 1e4), nrows)
counts2 <- matrix(runif(nrows * ncols, 1, 1e4), nrows)
rowRanges <- GRanges(rep(c("chr1", "chr2"), c(50, 150)),
IRanges(floor(runif(200, 1e5, 1e6)), width=100),
strand=sample(c("+", "-"), 200, TRUE))
colData <- DataFrame(Treatment=rep(c("ChIP", "Input"), 3),
row.names=LETTERS[1:6])
colData <- DataFrame(sample_metadata)
sset <- SummarizedExperiment(assays=SimpleList(counts=as.matrix(data)),
rowData=DataFrame(gene_metadata), colData=colData)
ggplot(sset) + geom_raster(aes(x = Age, y = y , fill = value))
```


```{r}
library(SummarizedExperiment)
nrows <- 200
ncols <- 6
counts <- matrix(runif(nrows * ncols, 1, 1e4), nrows)
counts2 <- matrix(runif(nrows * ncols, 1, 1e4), nrows)
rowRanges <- GRanges(rep(c("chr1", "chr2"), c(50, 150)),
  IRanges(floor(runif(200, 1e5, 1e6)), width = 100),
  strand = sample(c("+", "-"), 200, TRUE)
)
colData <- DataFrame(
  Treatment = rep(c("ChIP", "Input"), 3),
  row.names = LETTERS[1:6]
)
colData <- DataFrame(sample_metadata)
sset <- SummarizedExperiment(
  assays = SimpleList(
    counts = counts,
    counts2 = counts2
  ),
  rowRanges = rowRanges, colData = colData
)
ggplot(sset) +
  geom_raster(aes(x = x, y = y, fill = value))
```

```{r}
$x %>% 
  as.data.frame %>%
  ggplot(aes(x=PC1,y=PC2)) + geom_point(size=4) +
  theme_bw(base_size=32) + 
  labs(x=paste0("PC1: ",round(var_explained[1]*100,1),"%"),
       y=paste0("PC2: ",round(var_explained[2]*100,1),"%")) +
  theme(legend.position="top")
```